<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Best practices for building container images for ComputeStacks"><link rel="shortcut icon" href=../../../images/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-6.2.4"><title>Building Images - ComputeStacks Documentation</title><link rel=stylesheet href=../../../assets/stylesheets/main.15aa0b43.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.75751829.min.css><meta name=theme-color content=#2094f3><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=stylesheet href=../../../css/timeago.css></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=orange> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#building-images-for-computestacks class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=../../.. title="ComputeStacks Documentation" class="md-header-nav__button md-logo" aria-label="ComputeStacks Documentation"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><defs><style>.fa-secondary{opacity:.4}</style></defs><path class=fa-secondary d="M96 0H32A32 32 0 0 0 0 32v64h128V32A32 32 0 0 0 96 0zM0 384h128V128H0zm0 96a32 32 0 0 0 32 32h64a32 32 0 0 0 32-32v-64H0zm513.62-17.78L401.08 42.71l-60.26 16.14 112.35 418.8c.11.39.2.79.29 1.18l60.29-16.15c-.04-.15-.09-.3-.13-.46zM160 480a32 32 0 0 0 32 32h64a32 32 0 0 0 32-32v-64H160zM256 0h-64a32 32 0 0 0-32 32v64h124.79l-8-29.65a23.94 23.94 0 0 1 11.17-27V32A32 32 0 0 0 256 0zm-96 384h128V128H160z"/><path class=fa-primary d="M0 416h128v-32H0zm0-288h128V96H0zm575.17 317.65L460.39 17.78a23.89 23.89 0 0 0-29.18-17h-.09L415.73 5a24 24 0 0 0-16.9 29.36l114.79 427.86a23.89 23.89 0 0 0 29.18 17h.09l15.38-4.22a24 24 0 0 0 16.9-29.35zM160 416h128v-32H160zM338.39 49.78a23.89 23.89 0 0 0-29.18-17h-.09L293.73 37a24 24 0 0 0-16.9 29.36l8 29.65H160v32h128V108l103.62 386.22a23.89 23.89 0 0 0 29.18 17h.09l15.38-4.22a24 24 0 0 0 16.9-29.33z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <div class=md-header-nav__topic> <span class=md-ellipsis> ComputeStacks Documentation </span> </div> <div class=md-header-nav__topic> <span class=md-ellipsis> Building Images </span> </div> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../getting_started/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../../admin_guide/ class=md-tabs__link> Admin Guide </a> </li> <li class=md-tabs__item> <a href=../../ class="md-tabs__link md-tabs__link--active"> User Guide </a> </li> <li class=md-tabs__item> <a href=../../../admin_api/ class=md-tabs__link> Admin API </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="ComputeStacks Documentation" class="md-nav__button md-logo" aria-label="ComputeStacks Documentation"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><defs><style>.fa-secondary{opacity:.4}</style></defs><path class=fa-secondary d="M96 0H32A32 32 0 0 0 0 32v64h128V32A32 32 0 0 0 96 0zM0 384h128V128H0zm0 96a32 32 0 0 0 32 32h64a32 32 0 0 0 32-32v-64H0zm513.62-17.78L401.08 42.71l-60.26 16.14 112.35 418.8c.11.39.2.79.29 1.18l60.29-16.15c-.04-.15-.09-.3-.13-.46zM160 480a32 32 0 0 0 32 32h64a32 32 0 0 0 32-32v-64H160zM256 0h-64a32 32 0 0 0-32 32v64h124.79l-8-29.65a23.94 23.94 0 0 1 11.17-27V32A32 32 0 0 0 256 0zm-96 384h128V128H160z"/><path class=fa-primary d="M0 416h128v-32H0zm0-288h128V96H0zm575.17 317.65L460.39 17.78a23.89 23.89 0 0 0-29.18-17h-.09L415.73 5a24 24 0 0 0-16.9 29.36l114.79 427.86a23.89 23.89 0 0 0 29.18 17h.09l15.38-4.22a24 24 0 0 0 16.9-29.35zM160 416h128v-32H160zM338.39 49.78a23.89 23.89 0 0 0-29.18-17h-.09L293.73 37a24 24 0 0 0-16.9 29.36l8 29.65H160v32h128V108l103.62 386.22a23.89 23.89 0 0 0 29.18 17h.09l15.38-4.22a24 24 0 0 0 16.9-29.33z"/></svg> </a> ComputeStacks Documentation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Getting Started <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Getting Started" data-md-level=1> <label class=md-nav__title for=nav-2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../getting_started/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../../getting_started/architecture_overview/ class=md-nav__link> Architecture </a> </li> <li class=md-nav__item> <a href=../../../getting_started/community/ class=md-nav__link> Community </a> </li> <li class=md-nav__item> <a href=../../../getting_started/notifications/ class=md-nav__link> Notifications </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-5 type=checkbox id=nav-2-5> <label class=md-nav__link for=nav-2-5> Installation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Installation data-md-level=2> <label class=md-nav__title for=nav-2-5> <span class="md-nav__icon md-icon"></span> Installation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../getting_started/installation/0_requirements/ class=md-nav__link> Plan </a> </li> <li class=md-nav__item> <a href=../../../getting_started/installation/1_prepare/ class=md-nav__link> Prepare </a> </li> <li class=md-nav__item> <a href=../../../getting_started/installation/2_perform/ class=md-nav__link> Run </a> </li> <li class=md-nav__item> <a href=../../../getting_started/installation/3_finalize/ class=md-nav__link> Finalize </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-6 type=checkbox id=nav-2-6> <label class=md-nav__link for=nav-2-6> Integrations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Integrations data-md-level=2> <label class=md-nav__title for=nav-2-6> <span class="md-nav__icon md-icon"></span> Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../getting_started/integrations/cpanel_plugin/ class=md-nav__link> cPanel </a> </li> <li class=md-nav__item> <a href=../../../getting_started/integrations/webhooks/ class=md-nav__link> WebHooks </a> </li> <li class=md-nav__item> <a href=../../../getting_started/integrations/whmcs_plugin/ class=md-nav__link> WHMCS </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Admin Guide <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Admin Guide" data-md-level=1> <label class=md-nav__title for=nav-3> <span class="md-nav__icon md-icon"></span> Admin Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../admin_guide/ class=md-nav__link> Overview </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-2 type=checkbox id=nav-3-2> <label class=md-nav__link for=nav-3-2> Billing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Billing data-md-level=2> <label class=md-nav__title for=nav-3-2> <span class="md-nav__icon md-icon"></span> Billing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../admin_guide/billing/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../../admin_guide/billing/billing_plans/ class=md-nav__link> Billing Plans </a> </li> <li class=md-nav__item> <a href=../../../admin_guide/billing/free_trial/ class=md-nav__link> Setup Free Trials </a> </li> <li class=md-nav__item> <a href=../../../admin_guide/billing/integrations/ class=md-nav__link> Handle Invoicing & Payments </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-3 type=checkbox id=nav-3-3> <label class=md-nav__link for=nav-3-3> Cluster Management <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Cluster Management" data-md-level=2> <label class=md-nav__title for=nav-3-3> <span class="md-nav__icon md-icon"></span> Cluster Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../admin_guide/cluster_management/change_region_name/ class=md-nav__link> Rename Region </a> </li> <li class=md-nav__item> <a href=../../../admin_guide/cluster_management/cs_database/ class=md-nav__link> Controller Database </a> </li> <li class=md-nav__item> <a href=../../../admin_guide/cluster_management/load_balancer/ class=md-nav__link> Load Balancer </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-4 type=checkbox id=nav-3-4> <label class=md-nav__link for=nav-3-4> Custom Integrations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Custom Integrations" data-md-level=2> <label class=md-nav__title for=nav-3-4> <span class="md-nav__icon md-icon"></span> Custom Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../admin_guide/custom_integration/full_api/ class=md-nav__link> API Only </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4 type=checkbox id=nav-4 checked> <label class=md-nav__link for=nav-4> User Guide <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="User Guide" data-md-level=1> <label class=md-nav__title for=nav-4> <span class="md-nav__icon md-icon"></span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../backups/ class=md-nav__link> Backups </a> </li> <li class=md-nav__item> <a href=../../developer-tools/ class=md-nav__link> Developer Tools </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-4 type=checkbox id=nav-4-4> <label class=md-nav__link for=nav-4-4> Container Images <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Container Images" data-md-level=2> <label class=md-nav__title for=nav-4-4> <span class="md-nav__icon md-icon"></span> Container Images </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../container_images/elastic-search/ class=md-nav__link> ElasticSearch </a> </li> <li class=md-nav__item> <a href=../../container_images/redis/ class=md-nav__link> Redis </a> </li> <li class=md-nav__item> <a href=../../container_images/wordpress/ class=md-nav__link> Wordpress </a> </li> <li class=md-nav__item> <a href=../../container_images/whmcs/ class=md-nav__link> WHMCS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5 type=checkbox id=nav-4-5> <label class=md-nav__link for=nav-4-5> Core Concepts <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Core Concepts" data-md-level=2> <label class=md-nav__title for=nav-4-5> <span class="md-nav__icon md-icon"></span> Core Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../core-concepts/mail/ class=md-nav__link> Sending Mail </a> </li> <li class=md-nav__item> <a href=../../core-concepts/ssh/ class=md-nav__link> SSH & File Access </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-6 type=checkbox id=nav-4-6 checked> <label class=md-nav__link for=nav-4-6> How To <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="How To" data-md-level=2> <label class=md-nav__title for=nav-4-6> <span class="md-nav__icon md-icon"></span> How To </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Building Images <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Building Images </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#before-you-start class=md-nav__link> Before you start </a> <nav class=md-nav aria-label="Before you start"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#docker-installation class=md-nav__link> Docker Installation </a> </li> <li class=md-nav__item> <a href=#understand-container-registries class=md-nav__link> Understand Container Registries </a> </li> <li class=md-nav__item> <a href=#make-use-of-our-metadata-service class=md-nav__link> Make use of our Metadata service </a> </li> <li class=md-nav__item> <a href=#external-resources class=md-nav__link> External Resources </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#recommended-best-practices class=md-nav__link> Recommended Best Practices </a> </li> <li class=md-nav__item> <a href=#define-your-image class=md-nav__link> Define Your Image </a> <nav class=md-nav aria-label="Define Your Image"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#add-your-image class=md-nav__link> Add your image </a> </li> <li class=md-nav__item> <a href=#configure-parameters class=md-nav__link> Configure Parameters </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../clone-project/ class=md-nav__link> Cloning Projects </a> </li> <li class=md-nav__item> <a href=../moving/ class=md-nav__link> Migrating Existing Application </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-7 type=checkbox id=nav-4-7> <label class=md-nav__link for=nav-4-7> Third Party <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Third Party" data-md-level=2> <label class=md-nav__title for=nav-4-7> <span class="md-nav__icon md-icon"></span> Third Party </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../third-party/cloudflare/ class=md-nav__link> Cloudflare </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Admin API <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Admin API" data-md-level=1> <label class=md-nav__title for=nav-5> <span class="md-nav__icon md-icon"></span> Admin API </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../admin_api/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../../admin_api/container_services/ class=md-nav__link> Container Services </a> </li> <li class=md-nav__item> <a href=../../../admin_api/images/ class=md-nav__link> Images </a> </li> <li class=md-nav__item> <a href=../../../admin_api/projects/ class=md-nav__link> Projects </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> Billing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Billing data-md-level=2> <label class=md-nav__title for=nav-5-5> <span class="md-nav__icon md-icon"></span> Billing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../admin_api/billing/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../../admin_api/billing/products/ class=md-nav__link> Products </a> </li> <li class=md-nav__item> <a href=../../../admin_api/billing/billing_plans/ class=md-nav__link> Billing Plans </a> </li> <li class=md-nav__item> <a href=../../../admin_api/billing/resources/ class=md-nav__link> Billing Resources </a> </li> <li class=md-nav__item> <a href=../../../admin_api/billing/phases/ class=md-nav__link> Billing Phases </a> </li> <li class=md-nav__item> <a href=../../../admin_api/billing/prices/ class=md-nav__link> Resource Prices </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-6 type=checkbox id=nav-5-6> <label class=md-nav__link for=nav-5-6> Infrastructure <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Infrastructure data-md-level=2> <label class=md-nav__title for=nav-5-6> <span class="md-nav__icon md-icon"></span> Infrastructure </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../admin_api/infrastructure/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../../admin_api/infrastructure/locations/ class=md-nav__link> Regions </a> </li> <li class=md-nav__item> <a href=../../../admin_api/infrastructure/regions/ class=md-nav__link> Availability Zones </a> </li> <li class=md-nav__item> <a href=../../../admin_api/infrastructure/nodes/ class=md-nav__link> Nodes </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-7 type=checkbox id=nav-5-7> <label class=md-nav__link for=nav-5-7> Networking <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Networking data-md-level=2> <label class=md-nav__title for=nav-5-7> <span class="md-nav__icon md-icon"></span> Networking </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../admin_api/networking/domains/ class=md-nav__link> Domains </a> </li> <li class=md-nav__item> <a href=../../../admin_api/networking/ingress_rules/ class=md-nav__link> Ingress Rules </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-8 type=checkbox id=nav-5-8> <label class=md-nav__link for=nav-5-8> Subscription Management <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Subscription Management" data-md-level=2> <label class=md-nav__title for=nav-5-8> <span class="md-nav__icon md-icon"></span> Subscription Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../admin_api/subscriptions/subscriptions/ class=md-nav__link> Subscriptions </a> </li> <li class=md-nav__item> <a href=../../../admin_api/subscriptions/usage/ class=md-nav__link> Usage </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-9 type=checkbox id=nav-5-9> <label class=md-nav__link for=nav-5-9> User Management <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="User Management" data-md-level=2> <label class=md-nav__title for=nav-5-9> <span class="md-nav__icon md-icon"></span> User Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../admin_api/users/ class=md-nav__link> Users </a> </li> <li class=md-nav__item> <a href=../../../admin_api/users/user_groups/ class=md-nav__link> Groups </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1 id=building-images-for-computestacks>Building Images for ComputeStacks<a class=headerlink href=#building-images-for-computestacks title="Permanent link">&para;</a></h1> <h2 id=before-you-start>Before you start<a class=headerlink href=#before-you-start title="Permanent link">&para;</a></h2> <h3 id=docker-installation>Docker Installation<a class=headerlink href=#docker-installation title="Permanent link">&para;</a></h3> <p>These examples require that you have access to a local installation of Docker.</p> <details class=question><summary>How do I install docker?</summary><p>If you don&rsquo;t already have it installed, you can install it from:</p> <ul> <li><a href=https://download.docker.com/mac/stable/Docker.dmg>Download Docker for Mac</a></li> <li><a href=https://download.docker.com/win/stable/Docker%20for%20Windows%20Installer.exe>Download Docker for Windows</a></li> <li>Download Docker for Linux:<ul> <li><a href=https://docs.docker.com/install/linux/docker-ce/centos/ >Docker for Centos</a></li> <li><a href=https://docs.docker.com/install/linux/docker-ce/debian/ >Docker for Debian</a></li> <li><a href=https://docs.docker.com/install/linux/docker-ce/fedora/ >Docker for Fedora</a></li> <li><a href=https://docs.docker.com/install/linux/docker-ce/ubuntu/ >Docker for Ubuntu</a></li> </ul> </li> </ul> </details> <h3 id=understand-container-registries>Understand Container Registries<a class=headerlink href=#understand-container-registries title="Permanent link">&para;</a></h3> <p>The first step in building your docker container is choosing a place to store your image. This is how ComputeStacks will access the finished image and deploy it on the cluster.</p> <p>You can use popular options like <a href=https://hub.docker.com target=_blank>Docker Hub</a>, <a href=https://github.com target=_blank>GitHub</a>, or <a href=https://about.gitlab.com target=_blank>Gitlab</a>, or you can use the built-in Container Registry that&rsquo;s included with ComputeStacks.</p> <p>To use ComputeStacks, login to your account and navigate to <em>Container Registry</em>. Click &lsquo;New Registry&rsquo; if you don&rsquo;t already have one and give it a friendly name. </p> <p>A container registry can hold an unlimited number of images, so you only need one. However, if you&rsquo;re working with multiple people, you may want to create a registry per-project so you can selectively give access to the developers who need to push images. </p> <p>Once your registry is created, make note of the <em>registry url</em> and the <em>username</em>, and <em>password.</em></p> <p>On your local instance of docker, open a command prompt and enter <code>docker login &lt;registry-url&gt;</code>.</p> <h3 id=make-use-of-our-metadata-service>Make use of our Metadata service<a class=headerlink href=#make-use-of-our-metadata-service title="Permanent link">&para;</a></h3> <p>When building multi-container services, you can leverage our <a href=../../developer-tools/#metadata-service>Metadata service</a> to automate the configuration step of your application. For example, in our Elasticsearch image, we bundle a nginx container to provide an auth layer in front of ElasticSearch. We use the metadata service to discover the ElasticSearch instances and reconfigure the nginx load balancer automatically.</p> <h3 id=external-resources>External Resources<a class=headerlink href=#external-resources title="Permanent link">&para;</a></h3> <p>Here are some great external resources to review:</p> <ul> <li><a href=https://github.com/ComputeStacks/docker target=_blank>ComputeStacks docker image library</a></li> <li><a href=https://docs.docker.com/engine/reference/builder/ target=_blank>Dockerfile reference</a></li> <li><a href=https://bitnami.com/stacks/containers target=_blank>Bitnami docker images</a></li> </ul> <h2 id=recommended-best-practices>Recommended Best Practices<a class=headerlink href=#recommended-best-practices title="Permanent link">&para;</a></h2> <details class=info><summary>Don&rsquo;t reinvent the wheel</summary><p>Try to use well-maintained images as the foundation for your custom image.</p> </details> <details class=info><summary>Enable SFTP Access</summary><p>To enable SFTP access to your container, you will need to ensure file permissions are set correctly. For this to work, you will need the match the UID/GID of the user in your container, with the user of the SFTP/SSH container. Here is an example from a <code>Dockerfile</code> for our PHP image:</p> <div class=highlight><pre><span></span><code><span class=k>RUN</span> usermod -u <span class=m>1001</span> www-data <span class=se>\</span>
    <span class=o>&amp;&amp;</span> groupmod -g <span class=m>1001</span> www-data
</code></pre></div> <p>You will also need to make sure you run <code>chown -R</code> on any files added to the container during the build process. This can be done as another <code>RUN</code> command, or as part of your <code>entrypoint</code> script.</p> <p>You may also want to rest all file/folder permissions with something like this:</p> <div class=highlight><pre><span></span><code>find . -type d -exec chmod <span class=m>755</span> <span class=o>{}</span> <span class=se>\;</span> 
find . -type f -exec chmod <span class=m>644</span> <span class=o>{}</span> <span class=se>\;</span>
</code></pre></div> </details> <details class=info><summary>Don&rsquo;t hardcode configuration</summary><p>Do not hard code any database credentials, or other configuration that requires up front knowledge of the environment. Instead, make all the options configurable as <code>ENV</code> variables that are accessible to an <code>entrypoint</code> script that can configure your application at run time. </p> <p>See our <a href=https://github.com/ComputeStacks/docker/blob/master/wordpress/php7.3-litespeed/10-wordpress.sh target=_blank>Wordpress image</a> as an example.</p> <p>Our <code>entrypoint</code> script takes the database settings from the environment, and configures the wordpress database settings.</p> </details> <details class=info><summary>Adjust your webserver to retrieve the real IP of your visitors</summary><p>Your application will sit behind the ComputeStacks load balancer. This means your application will not have direct access to the real remote address of the visitor. In order to access that data, you will need to read the header <code>X-Forwarded-For</code>.</p> </details> <details class=info><summary>Prevent SSL &lsquo;Too many redirects&rsquo; error</summary><p>By default, most images are configured to listen on port <code>80</code> with the global load balancer performing SSL offloading on your behalf. In this situation, your app may not realize that the user is connected over SSL and try to redirect them to <code>443</code>. In this scenario, you will most likely have a redirect error. </p> <p>To accurately determine the protocol that the user is connecting over, you should look for the <code>HTTP_X_FORWARDED_PROTO</code> header being sent by our load balancer.</p> <p>Additionally, if you would like to also secure the connection between the application and our load balancer, you can optionally enable the <code>Backend SSL</code> setting in the appropriate ingress rule.</p> <p>For example, in our Wordpress image, we use:</p> <div class=highlight><pre><span></span><code><span class=cp>&lt;?php</span>
<span class=k>if</span> <span class=p>(</span><span class=nb>isset</span><span class=p>(</span><span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;HTTP_X_FORWARDED_PROTO&#39;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;HTTP_X_FORWARDED_PROTO&#39;</span><span class=p>]</span> <span class=o>===</span> <span class=s1>&#39;https&#39;</span><span class=p>)</span> <span class=p>{</span>
    <span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;HTTPS&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;on&#39;</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> </details> <details class=info><summary>Persist your data in volumes</summary><p>By default, all docker containers are stateless. This means that the data within the container can go away at any time. To avoid losing data, it&rsquo;s important you define Volumes within ComputeStacks. </p> <p>ComputeStacks has no awareness of your Dockerfile, therefore volumes defined in your Dockerfile will have <em>no effect.</em> You <strong>must</strong> define them in ComputeStacks.</p> </details> <details class=tip><summary>Test your image!</summary><p>Be sure to test your image thoroughly before pushing to ComputeStacks. While we offer a lot of insight and data into your running container, the iterative process of resolving issues will be much faster locally then within the ComputeStacks environment.</p> </details> <h2 id=define-your-image>Define Your Image<a class=headerlink href=#define-your-image title="Permanent link">&para;</a></h2> <p>Now that you&rsquo;ve built, tested, and pushed, your image, it&rsquo;s time to configure it in ComputeStacks.</p> <h3 id=add-your-image>Add your image<a class=headerlink href=#add-your-image title="Permanent link">&para;</a></h3> <p>You have two options when creating your image in ComputeStacks. If you&rsquo;re using our built-in container registry, then you can navigate to your regsitry and click the tag you want to use. This will take you to the new image page with the registry details pre-filled out.</p> <p><a href=/images/content/building-images/container-registry-link.png target=_blank> <img alt="Link Registry Image" src=/images/content/building-images/container-registry-link.png style=width:60%;margin-left:15%;> </a></p> <p>To create an image hosted elsewhere, create a new image directly from the image section and enter the details. </p> <div class="admonition warning"> <p class=admonition-title>Enable Scaling</p> <p>Does your image support horizontal scaling? If so, check this box and you&rsquo;ll be able to scale the app once it&rsquo;s deployed.</p> </div> <p>On this screen you will notice a <code>Command</code> setting: This is how you can pass parameters directly to process running within the container. Here are some examples of how to use that setting:</p> <ul> <li>MySQL &amp; MariaDB, we set the following command: <code>--max_allowed_packet=268435456</code>.</li> <li>For Redis, we enable password authentication by referencing the <a href=#settings>password setting</a>: <code>/bin/sh -c redis-server --requirepass</code><ul> <li><code>password</code> is the name of a setting we defined for this image. <a href=#settings>see below</a>.</li> </ul> </li> </ul> <div class="admonition tip"> <p class=admonition-title>Use /bin/sh when overriding the command</p> <p>If you&rsquo;re trying to override the command itself and not just pass extra parameters, enclose your command with <code>/bin/sh -c</code>.</p> </div> <h3 id=configure-parameters>Configure Parameters<a class=headerlink href=#configure-parameters title="Permanent link">&para;</a></h3> <p>Here are two examples from our Wordpress service:</p> <p><a href=/images/content/building-images/image-settings-overview-wordpress.png target="&#34;_blank'"> <img alt="Configure Wordpress Image" src=/images/content/building-images/image-settings-overview-wordpress.png style=width:48%;> </a> <a href=/images/content/building-images/image-settings-overview-wordpress.png target="&#34;_blank'"> <img alt="Configure Wordpress Image" src=/images/content/building-images/image-settings-overview-mariadb.png style=width:48%;float:right;> </a></p> <div style=clear:both;></div> <h4>Settings</h4> <p>This is the heart of your container configuration. You will define user-supplied settings, or dynamically generated strings, with this section. You can reference the result of these as variables in both the <code>command</code> setting, or in <code>environmental settings</code>, for both this container, and any container that references this container.</p> <h4>Volumes</h4> <p>This is where you define persistent storage for containers.</p> <p><code>Enable SFTP</code> will ensure you can SFTP into your image and access the files remotely.</p> <h4>Environmental Variables</h4> <p>These will be passed directly to the image as <code>-e</code> params. </p> <p>You have two choices:</p> <ol> <li><strong>Static</strong>: Whatever you type will be passed to the container</li> <li><strong>Variables</strong>: Dynamically generate the value</li> </ol> <h4>Ingress Rules</h4> <p>This tells ComputeStacks how to route traffic to your container.</p> <ul> <li><strong>Port</strong>: What port is the container listening on? </li> <li><strong>Protocol</strong>: Define the protocol. For HTTP/S, all external traffic will be routed from 80/443, to the port defined in the first step. TCP/TLS will be assigned a random port.</li> <li><strong>Enable External Access</strong>: Setting this to true will enable external access either through our load balancer, or a NAT rule on the host.</li> </ul> <h5>Load Balancer Options</h5> <ul> <li><strong>TCP Proxy Options</strong>: In general, this should always be disabled, otherwise you could break communication with your app. If your application specifically supports the <code>send-proxy</code> option, you can configure it here. (<a href=https://cbonte.github.io/haproxy-dconv/1.8/configuration.html#5.2-send-proxy target=_blank>learn more</a>)</li> <li><strong>Cloudflare</strong>: <em>This is only available when editing the ingress rule on a running service.</em> This allows you to restrict access to your service to only Cloudflare. (<a href=../third-party/cloudflare>learn more</a>)</li> <li><strong>Enable TCP LoadBalancing</strong>: If true, traffic will be routed through the global load balancer. You <em>must</em> enable this if you plan to use ComputeStacks to manage domain names and SSL Certificates. Otherwise, you will need to configure that directly in your container.</li> </ul> <h4>Persistent Storage (Volumes)</h4> <p>Any data changed or created by your container can be lost at any time, so it&rsquo;s important create volumes to persist your data. In addition to defining your volumes, you may also configure our integrated backup tool. (<a href=../../backups/ >learn more</a>)</p> <p>We recommend only 1 volume per container, however we recognize that sometimes that is not feasible. For example, we use 2 volumes in our <a href=https://github.com/ComputeStacks/docker/master/tree/php/open-litespeed target=_blank>OpenLiteSpeed based images</a>.</p> <p>The primary reason we recommend using a single volume is to ensure that when backups are performed, they&rsquo;re getting a consistent point in time snapshot of your data.</p> <hr> <div class=md-source-date> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2021-05-17T14:44:01+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2021-05-17</span> </small> </div> </article> </div> </div> </main> <!-- Override https://github.com/squidfunk/mkdocs-material/blob/master/material/partials/footer.html --> <script>
window.belcoConfig = {
  shopId: 'qMeM9TQt8D5dQSc3j'
};
</script> <script>!function(n,o){var e=window.belcoFunction||"Belco";window[e]||(window[e]=function(n){if(void 0===window[e][n])throw new Error("Unknown method");return window[e][n].apply(window[e],Array.prototype.slice.call(arguments,1))}),window[e]._q=[];for(var i=["init","sync","track","page","open","close","toggle","on","once","off","anonymousId","customer","reset","sendMessage"],t=function(n){return function(){var o=Array.prototype.slice.call(arguments);return o.unshift(n),window[e]._q.push(o),window[e]}},w=0;w<i.length;w++){var r=i[w];window[e][r]=t(r)}window[e].load=function(e){if(!n.getElementById("belco-js")){var i=n.createElement(o);i.async=!0,i.id="belco-js",i.type="text/javascript",i.src="//cdn.belco.io/v2/widget.js",i.onload=function(n){"function"==typeof e&&e(n)};var t=n.getElementsByTagName(o)[0];t.parentNode.insertBefore(i,t)}},window.belcoConfig&&window[e].load(function(){window[e]("init",window.belcoConfig)})}(document,"script");</script> </div> <script src=../../../assets/javascripts/vendor.93c04032.min.js></script> <script src=../../../assets/javascripts/bundle.83e5331e.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script> <script>
        app = initialize({
          base: "../../..",
          features: ['navigation.instant', 'navigation.sections', 'navigation.tabs', 'toc.integrate'],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> <script src=../../../js/timeago.min.js></script> <script src=../../../js/timeago_mkdocs_material.js></script> </body> </html>